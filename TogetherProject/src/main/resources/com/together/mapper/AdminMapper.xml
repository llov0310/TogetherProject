<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.together.mapper.AdminMapper">

	<!--  select시 셀렉트문  insert시 태그를 각자 맞는 sql문을 쓴다 -->
	
	<!-- 관리자 홈페이지 : 총 회원수를 보여주는 sql문 -->
	<select id="memberCnt" resultType="int">
	<![CDATA[
	select count(*) 
	from member
	where user_id not in('admin')
	]]>
	</select>
	
	<!-- 관리자 홈페이지 : 업체 신청 수를 보여주는 sql문 -->
	<select id="etpApplyCnt" resultType="int">
	<![CDATA[
	select count(*)
	from member m, enterprise e
	where m.user_id = e.user_id and m.authority_no = 3
	]]>
	</select>
	
	<!-- 관리자 홈페이지 : 반려견 수를 보여주는 sql문 -->
	<select id="dogsCnt" resultType="int">
	<![CDATA[
	select count(*)
	from dogs
	]]>
	</select>
	
	<!-- 관리자 홈페이지 : 월 별 가입자 수를 보여주는 sql문 -->
	<select id="Cnt" resultType="com.together.domain.MemberVO">
	<![CDATA[
	select count(*) as count, to_char(register_dt, 'YYYY-MM') as register_dt
	from member
	group by to_char(register_dt, 'YYYY-MM')
	order by register_dt
	]]>
	</select>
	
	<!-- 업체 신청 관리 페이징을 위한 sql문 추가 -->
	<select id="enterpriseList" resultType="com.together.domain.EnterpriseVO" parameterType="com.together.domain.Paging">
	<![CDATA[
	select x.rnum, x.*
	from(
    	select rownum as rnum, A.*
    	from(
        	select m.user_nm, m.authority_no, substr(e.etp_cd, 1,1) as etp_cd_substr, e.etp_email, e.user_id, e.etp_addr, e.etp_ph_no, e.etp_license_no, e.etp_nm, e.etp_content
        	from member m, enterprise e
        	where m.user_id = e.user_id and m.authority_no = 3
    	) A
    	where rownum < ${endNum}
	) x
	where x.rnum >= ${startNum}
	]]>
	</select>
	
	
	<!-- 반려견 페이징을 위한 sql문 추가 -->
	<select id="dogsList" resultType="com.together.domain.DogsVO" parameterType="com.together.domain.Paging">
	<![CDATA[
	select x.rnum, x.*
	from (
    	select rownum as rnum, A.*
        	from (select d.user_id, m.user_nm, m.ph_no, d.d_gender, d.d_dt, d.d_addr, d.d_kind, d.d_nm, d.d_content
            	from dogs d, member m where d.user_id = m.user_id
        	) A
            	where rownum < ${endNum}
	) x
	where x.rnum >= ${startNum}
	]]>
	</select>
	
	<!-- 관리자가 업체 신청 수락시 수행될 sql문 추가 -->
	<update id="etpApplyManage_01" parameterType="com.together.domain.MemberVO">
	update member
	set authority_no = 2
	where user_id = #{user_id}
	</update>
	
	<!-- 관리자가 업체 신청 거절시 수행될 sql문 추가 -->
	<delete id="etpApplyManage_02" parameterType="com.together.domain.EnterpriseVO">
	delete from enterprise
	where user_id = #{user_id}
	</delete>
	
	<!-- 회원관리 페이징을 위한 sql문 추가 -->
	<select id="memberList" resultType="com.together.domain.MemberVO" parameterType="com.together.domain.Paging">
	<![CDATA[
		select x.rnum, x.*
		from (select rownum as rnum, A.*
    	from (select * from member) A
    	where rownum < ${endNum}
		) x
		where x.rnum >= ${startNum}	
	]]>
	</select>
	
	<select id="getPageNum" resultType="int">
		select count(*) from member
	</select>
</mapper>