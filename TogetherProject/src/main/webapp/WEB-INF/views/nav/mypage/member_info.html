<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="include/serviceLayout">

<th:block layout:fragment="page_head">
	<title>정보수정</title>
	<script>
		$(document).ready(function() {
			$("#newinfo").hide();

			$("#passok").click(function() {
				var password = $("#pass").val();
				var user_id = $(".id").text();

				$.ajax({
					url : "/member_pass_cheak",
					type : "POST",
					dataType : 'text',
					data : {
						user_id : user_id,
						password : password
					},
					success : function(data) {
						if (data == "success") {
							alert("비밀번호 체크완료");
							$("#newinfo").show();
						} else {
							alert("현재 비밀번호가 맞지 않습니다");
							$("#pass").focus();
						}
					}

				});

			});
		});

		$(document).ready(function() {

			$("#upbtn").click(function() {
				

				if ($("#newemail").val() == "") {
					var email = $(".email").text();
				}else {
					var email = $("#newemail").val();
				}
				
				if($("#addr").val() == "") {
					var addr = $(".addr_ji").text();
					alert(addr);
				} else {
					var addr = $("#addr").val();
				}
				if ($("#addr2").val() == "") {
					var addr2 = $(".addr_dong").text();
					alert(addr2);
				} else {
					var addr2 = $("#addr2").val();
				}
				
				if ($("#newphon").val() == "") {
					var phon = $(".phon").text();
				} else {
					var phon = $("#newphon").val();
				}

				$.ajax({
					url : "/member_info_new",
					type : "POST",
					dataType : 'text',
					data : {
						
						email : email,
						addr_ji : addr,
						addr_dong : addr2,
						phon : phon
					},
					success : function(data) {
						if(data== "success"){
							alert("변경완료");
							$("#content").load("/member_info" );
							
						}else {
							alert("실패");
						}
						
					}

				});
			});
		});
	
		$(document).ready(
				function() {
					$("#newpass").click(
							function() {
								window.open("/newpwpopup", "newpass",
										"width=500,height=350,left=600");

							});
				});
	</script>

	<script>
		function address_code() {
			new daum.Postcode({
				oncomplete : function(data) {
					// 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

					// 도로명 주소의 노출 규칙에 따라 주소를 표시한다.
					// 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
					var roadAddr = data.roadAddress; // 도로명 주소 변수
					var extraRoadAddr = ''; // 참고 항목 변수

					// 법정동명이 있을 경우 추가한다. (법정리는 제외)
					// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
					if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
						extraRoadAddr += data.bname;
					}
					// 건물명이 있고, 공동주택일 경우 추가한다.
					if (data.buildingName !== '' && data.apartment === 'Y') {
						extraRoadAddr += (extraRoadAddr !== '' ? ', '
								+ data.buildingName : data.buildingName);
					}
					// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
					if (extraRoadAddr !== '') {
						extraRoadAddr = ' (' + extraRoadAddr + ')';
					}

					// 우편번호와 주소 정보를 해당 필드에 넣는다.
					//		            document.getElementById('sample4_postcode').value = data.zonecode;
					document.getElementById("addr").value = roadAddr;
					//		            document.getElementById("sample4_jibunAddress").value = data.jibunAddress;

					// 참고항목 문자열이 있을 경우 해당 필드에 넣는다.
					// 		            if(roadAddr !== ''){
					// 		                document.getElementById("addr_simple").value = extraRoadAddr;
					// 		            } else {
					// 		                document.getElementById("addr_simple").value = '';
					// 		            }

					//		            var guideTextBox = document.getElementById("guide");
					// 사용자가 '선택 안함'을 클릭한 경우, 예상 주소라는 표시를 해준다.
					//		            if(data.autoRoadAddress) {
					//		                var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
					//		                guideTextBox.innerHTML = '(예상 도로명 주소 : ' + expRoadAddr + ')';
					//		                guideTextBox.style.display = 'block';
					//
					//		            } else if(data.autoJibunAddress) {
					//		                var expJibunAddr = data.autoJibunAddress;
					//		                guideTextBox.innerHTML = '(예상 지번 주소 : ' + expJibunAddr + ')';
					//		                guideTextBox.style.display = 'block';
					//		            } else {
					//		                guideTextBox.innerHTML = '';
					//		                guideTextBox.style.display = 'none';
					//		            }
				}
			}).open();
		}
	</script>

</th:block>
<th:block layout:fragment="page_css">
</th:block>
<th:block layout:fragment="page_js">
</th:block>
<th:block layout:fragment="contents">
	<div id="ppap">
		<div id="dddd">
			<h2>회원정보 수정</h2>
		</div>
		프로필 사진 수정
		<div th:if="${session.user} != null">
			<div>
				아이디 : <span class="id" th:text="${session.user.user_id}"></span>
			</div>
			<div>
				이름 : <span th:text="${session.user.user_nm}"></span>
			</div>
			<div>
				생년월일 <span th:text="${session.user.birth_dt}"></span>
			</div>
			<div>
				주소 <span class="addr_ji" th:text="${session.user.addr_ji}"></span> <span
					class="addr_dong" th:text="${session.user.addr_dong}"></span>
			</div>
			<div>
				이메일 <span class="email" th:text="${session.user.email}"></span>
			</div>
			<div>
				폰번호 <span class="phon" th:text="${session.user.ph_no}"></span>
			</div>
			<div>
				정보 변경<br> 현재비밀번호 : <input type="password" id="pass"
					name="password">
				<button id="passok">확인</button>
				<br>
				<div id="newinfo">
					비밀번호 변경하기
					<button id="newpass">비밀변호 변경하기</button>
					<div>
						변경할 이메일 <input type="email" id="newemail">
					</div>
					<div>
						변경할 핸드폰번호<input type="text" id="newphon">
					</div>
					<div>
						주소주소 <input type="text" id="addr" placeholder="우편번호 검색을 해주세요"
							onclick="address_code()"><br> 
							<input type="text" id="addr2" placeholder="상세주소"><br>



					</div>
					<div>
						<button id="upbtn">수정하기</button>
					</div>
				</div>


			</div>
		</div>
	</div>
</th:block>